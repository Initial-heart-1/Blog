

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://blog-1253237490.cos.ap-beijing.myqcloud.com/Ann_H_logo.webp">
  <link rel="icon" href="https://blog-1253237490.cos.ap-beijing.myqcloud.com/Ann_H_logo.webp">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Initial heart">
  <meta name="keywords" content="">
  
    <meta name="description" content="在 CQ 还没凉那会儿笔者就在折腾 QQBot 了，第一次整 Bot 至今得有个七八年了，但是 CQ 凉了之后就没整了，很巧的是那会入坑了方舟（被朋友拖进来的），后来见着了一个能合成游戏内抽卡图的机器人，首先就觉得惊奇，CQ 都凉了机器人是越来越罕见，然后觉得这玩意儿挺好，我得整一个。   那会这个机器人，也就是 Amiya-Bot，才刚 v3，笔者尝试部署，然后就被文档整懵了，遂放弃。">
<meta property="og:type" content="article">
<meta property="og:title" content="《明日方舟》机器人（其实是 QQBot 框架） Amiya-Bot 简明部署教程">
<meta property="og:url" content="https://www.initbili.top/2022/cl72v4s0m0002x8u7h1gmgvpf/">
<meta property="og:site_name" content="Initial_heart&#39;s Blog">
<meta property="og:description" content="在 CQ 还没凉那会儿笔者就在折腾 QQBot 了，第一次整 Bot 至今得有个七八年了，但是 CQ 凉了之后就没整了，很巧的是那会入坑了方舟（被朋友拖进来的），后来见着了一个能合成游戏内抽卡图的机器人，首先就觉得惊奇，CQ 都凉了机器人是越来越罕见，然后觉得这玩意儿挺好，我得整一个。   那会这个机器人，也就是 Amiya-Bot，才刚 v3，笔者尝试部署，然后就被文档整懵了，遂放弃。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.initbili.top/img/p2/img.png">
<meta property="og:image" content="https://www.initbili.top/img/p2/img_1.png">
<meta property="og:image" content="https://www.initbili.top/img/p2/img_2.png">
<meta property="og:image" content="https://www.initbili.top/img/p2/img_3.png">
<meta property="og:image" content="https://www.initbili.top/img/p2/img_4.png">
<meta property="og:image" content="https://www.initbili.top/img/p2/img_5.png">
<meta property="og:image" content="https://www.initbili.top/img/p2/img_6.png">
<meta property="article:published_time" content="2022-08-20T16:02:21.000Z">
<meta property="article:modified_time" content="2022-08-21T04:30:40.747Z">
<meta property="article:author" content="Initial heart">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://www.initbili.top/img/p2/img.png">
  
  
  
  <title>《明日方舟》机器人（其实是 QQBot 框架） Amiya-Bot 简明部署教程 - Initial_heart&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/style.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.initbili.top","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":60,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"#"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Initial heart</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://blog-1253237490.cos.ap-beijing.myqcloud.com/Bri_Schneiter_banner.webp') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="《明日方舟》机器人（其实是 QQBot 框架） Amiya-Bot 简明部署教程"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-21 00:02" pubdate>
          2022年8月21日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.6k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          63 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">《明日方舟》机器人（其实是 QQBot 框架） Amiya-Bot 简明部署教程</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2022年8月21日 下午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>  在 CQ 还没凉那会儿笔者就在折腾 QQBot 了，第一次整 Bot 至今得有个七八年了，但是 CQ 凉了之后就没整了，很巧的是那会入坑了方舟（被朋友拖进来的），后来见着了一个能合成游戏内抽卡图的机器人，首先就觉得惊奇，CQ 都凉了机器人是越来越罕见，然后觉得这玩意儿挺好，我得整一个。</p>
<p>  那会这个机器人，也就是 Amiya-Bot，才刚 v3，笔者尝试部署，然后就被文档整懵了，遂放弃。</p>
<p>  真正的第一次成功部署在 v4，那时数据库改成了 sqlite，免配置。</p>
<p>  现在这个项目的最新稳定版本是 v5，截至截稿之时 v6 发布了第二个 Alpha 版本。</p>
<p>  废话说得太多了，现在开始讲如何部署。</p>
<p>  在开始之前，需要说明的是，笔者因为自己就被文档坑过，所以为该项目完善了一些文档，下面可能会大量引用（当然，引用的文档不一定是笔者编写的），直接放上相关链接来看，本文只重点讲解文档没有涉及到的部分，比如 mirai 的部署和配置。引用的文档与本文采用相同方式许可。</p>
<h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h3><p>  作者在 Windows 环境下部署并编写本文，所以使用 Linux 的用户可能不能照抄，但是思路是一样的，抄个思路一般也没问题，不过要注意你的系统是否符合项目要求，具体系统要求如下：</p>
<blockquote>
<ul>
<li>仅支持 <strong>Windows 7</strong> 以上系统</li>
<li>仅支持 <strong>MacOS 10.14 Mojave</strong> 以上系统</li>
<li>Linux 系统仅支持 <strong>Ubuntu 18.04</strong> 以及 <strong>Ubuntu 20.04</strong></li>
</ul>
</blockquote>
<p>  其他的系统部分用户有成功部署的案例，但是显然不完全适用本文，如果你的系统不符合以上要求，你可以参照本文也就是一般部署的思路尝试部署在你的系统，但是可能会遇到一些困难。</p>
<p>  在开始正式部署前，我们有必要先了解一下项目的基本情况，否则可能会造成一些困扰。</p>
<p>  Amiya-Bot 是基于 mirai-api-http 的 Python “《明日方舟》机器人“（其实你完全可以把 ta 当一个机器人框架使用）。</p>
<p>  那么，mirai-api-http是什么？mirai-api-http（下称 MAH 或 mah） 是 mirai-console 的一个插件，原生的 mirai-console 插件使用 kt 或 java 编写，mirai-api-http 通过提供 API 的方式让更多语言可以接入 mirai-console。</p>
<p>  mirai 的相关介绍，由于其项目 README 有些限制，我不好引用，所以请 <a target="_blank" rel="noopener" href="https://github.com/mamoe/mirai">自己去看</a></p>
<p>  那么基本情况就介绍到这里，接下来开始正式的部署。</p>
<h3 id="2-部署-mirai"><a href="#2-部署-mirai" class="headerlink" title="2. 部署 mirai"></a>2. 部署 mirai</h3><p>  都说 Amiya-Bot 基于 mirai-api-http 了，那当然先得从”基于“开始做起嘛。就好像盖房子总得先盖地基一样，而 mirai-api-http 又基于 mirai-console （一般用户方便理解可以直接看作 mirai 本体），mirai 就像地基填的混凝土，而 mah 则是钢筋，所以我们先来进行混凝土的制作，也就是 mirai 的部署。</p>
<p>  部署 mirai 对于一般用户来说就是部署 mirai-console，mirai-console 有个启动器叫做 Mirai Console Loader 简称 MCL（下称可能为 mcl），而 MCL 又有个安装器叫做 MCL Installer（下称 MCLI 或 mcli），所以我们现在先去下载 MCL Installer。</p>
<p>  打开 <a target="_blank" rel="noopener" href="https://github.com/iTXTech/mcl-installer/releases">此页面</a>，找到最新的稳定 Release，下载对应你系统的版本。</p>
<p>  一般情况下，请下载含有 <code>x86</code> 的版本而不是 <code>arm64</code>。</p>
<p>  <img src="/img/p2/img.png" alt="Release，截至截稿时最新稳定版本为 1.0.7"></p>
<p>  下载完之后复制到你准备用来放 mirai 的目录，然后打开它。可能会弹出 UAC 警告，请确定。</p>
<p>  然后你会看到以下界面：</p>
<p>  <img src="/img/p2/img_1.png" alt="mcli 的初始界面"></p>
<p>  通常来说，如果你不是跟 Java 相关的开发者，是不会有如此高的 Java 版本的，最可能出现的是”1.8.0“甚至是没有 Java，那么笔者假设自己是”1.8.0“，并不满足 mirai 推荐的 Java 版本，所以我们输入 <code>Y</code> 并回车（当然如果你安装了版本 ≥11 的 JDK 那么可以选择输入N，但，Java 算不上大，独立隔离不影响系统的最新 Java 谁不爱呢？）。</p>
<p>  接下来会让你选择一系列选项，不一一放图讲解了，针对每个选项进行说明：</p>
<p>  Java 版本：推荐是能选到的最高，原因有多方面不展开讲，也许有机会会单独讲。</p>
<p>  JRE or JDK：推荐 <code>JDK</code>，不解释。</p>
<p>  Binary Architecture：通常来说，请输入 <code>x64</code> 而不是默认的 <code>x32</code>，这十分重要。</p>
<p>  然后会开始 Java 的下载，下载完后会出现 MCL 的公告，并有最新的 MCL 版本，询问你是否下载 MCL ，那当然是毫无疑问的选择 <code>Y</code>。</p>
<p>  <img src="/img/p2/img_2.png" alt="mcli 询问是否下载 MCL，截至截稿时最新版本为 2.1.0"></p>
<p>  选择好之后，很快会下载完成，按任意键就可以退出 MCLI，这个时候你可以安全的删除 MCLI 主程序。</p>
<p>  此时你已经成功部署好了 MCL，接下来就是配置了。</p>
<h3 id="3-配置-MCL"><a href="#3-配置-MCL" class="headerlink" title="3. 配置 MCL"></a>3. 配置 MCL</h3><p>  首先，我们要弄清楚如果你正确安装了 MCL，安装文件夹的目录结构是怎样的。</p>
<p>  在没有第一次运行 mcl 执行初始化时，安装目录结构如下：</p>
  <figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dos">注：已删除 mcli<br>  <br>├─ LICENSE  <br>├─ README.<span class="hljs-built_in">md</span>  <br>├─ java  <br>├─ mcl  <br>├─ mcl.<span class="hljs-built_in">cmd</span>  <br>└─ mcl.jar<br></code></pre></td></tr></table></figure>

<p>  现在我们要执行一次 mcl 以初始化，双击打开 <code>mcl.cmd</code>，你将看到以下界面：</p>
<p>  <img src="/img/p2/img_3.png" alt="mcl 自动下载最新的基础组件"></p>
<p>  在第一次启动 mcl 时，mcl 会自动下载最新的必要库或插件，列表如下：</p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">net<span class="hljs-selector-class">.mamoe</span>:mirai-console<br>net<span class="hljs-selector-class">.mamoe</span>:mirai-console-terminal<br>net<span class="hljs-selector-class">.mamoe</span>:mirai-core-<span class="hljs-attribute">all</span><br>org<span class="hljs-selector-class">.itxtech</span>:mcl-addon<br></code></pre></td></tr></table></figure>

<p>  当完成初始化（mcl 启动成功）时，mcl 会输出消息 <code>mirai-console started successfully.</code>。当你看到这条消息时，你就可以把 mcl 的窗口关上了。</p>
<p>  完成初始化后，安装目录结构如下：</p>
  <figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">├─ LICENSE<br>├─ README.md<br>├─ <span class="hljs-built_in">config</span><br>├─ <span class="hljs-built_in">config</span>.<span class="hljs-keyword">json</span><br><span class="hljs-keyword"></span>├─ data<br>├─ <span class="hljs-keyword">java</span><br><span class="hljs-keyword"></span>├─ libs<br>├─ logs<br>├─ mcl<br>├─ mcl.cmd<br>├─ mcl.<span class="hljs-keyword">jar</span><br><span class="hljs-keyword"></span>├─ plugin-libraries<br>├─ plugin-<span class="hljs-keyword">shared-libraries</span><br><span class="hljs-keyword"></span>└─ plugins<br></code></pre></td></tr></table></figure>

<p>  进入 <code>config\Console</code> 目录，打开 <code>AutoLogin.yml</code>，根据注释配置账号密码。</p>
<p>  请注意密码应填在 <code>value</code> 项而非 <code>kind</code>，参数名称后的冒号后有一个空格。</p>
<p>  假设我的账号是 <code>10001</code>，我的密码是 <code>mhtnbdhouse</code>，那么我应该这样填写配置：</p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">accounts:</span> <br><span class="hljs-bullet">-</span> <span class="hljs-comment"># 账号, 现只支持 QQ 数字账号</span><br>  <span class="hljs-attr">account:</span> <span class="hljs-number">10001</span><br>  <span class="hljs-attr">password:</span> <br>    <span class="hljs-comment"># 密码种类, 可选 PLAIN 或 MD5</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">PLAIN</span><br>    <span class="hljs-comment"># 密码内容, PLAIN 时为密码文本, MD5 时为 16 进制</span><br>    <span class="hljs-attr">value:</span> <span class="hljs-string">mhtnbdhouse</span><br>  <span class="hljs-comment"># 账号配置. 可用配置列表 (注意大小写):</span><br>  <span class="hljs-comment"># &quot;protocol&quot;: &quot;ANDROID_PHONE&quot; / &quot;ANDROID_PAD&quot; / &quot;ANDROID_WATCH&quot; / &quot;MACOS&quot; / &quot;IPAD&quot;</span><br>  <span class="hljs-comment"># &quot;device&quot;: &quot;device.json&quot;</span><br>  <span class="hljs-comment"># &quot;enable&quot;: true</span><br>  <span class="hljs-comment"># &quot;heartbeatStrategy&quot;: &quot;STAT_HB&quot; / &quot;REGISTER&quot; / &quot;NONE&quot;</span><br>  <span class="hljs-attr">configuration:</span> <br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">ANDROID_PHONE</span><br>    <span class="hljs-attr">device:</span> <span class="hljs-string">device.json</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">heartbeatStrategy:</span> <span class="hljs-string">STAT_HB</span><br></code></pre></td></tr></table></figure>

<p>  配置好之后保存退出。</p>
<p>  接下来再次打开 mcl，在一段时间的加载后会弹出这样的一个窗口：</p>
<p>  <img src="/img/p2/img_4.png" alt="mirai 的验证码弹窗 图片由用户友情提供"></p>
<p>  写得很清楚，”需要滑动验证码“，那么应该怎么获得 mirai 需要的 ticket 呢？</p>
<p>  既然你是冲着这个教程来的，当然是介绍最简单的方法！点击图中的 <code>Open with TxCaptchaHelper</code> 按钮，会弹出一个新的窗口：</p>
<p>  <img src="/img/p2/img_5.png" alt="TxCaptchaHelper 请求码弹窗 图片由用户友情提供"></p>
<p>  你可以在 <a target="_blank" rel="noopener" href="https://github.com/mzdluo123/TxCaptchaHelper/releases">这里</a> 下载到手机端，1.3 或者 1.2 任选（截稿时的最新版是 1.3，笔者使用 1.2，因为笔者死活上不去 AppCenter）。</p>
<p>  拿出你的手机，安装上面的手机端，然后打开它，它的界面是这样的：</p>
<p>  <img src="/img/p2/img_6.png" alt="滑动验证助手界面 图片由用户友情提供"></p>
<p>  输入上面要求要输的请求码，点下一步，会跳转验证码界面，完成之后会自动上传到服务器，服务器将 ticket 下发到你的机器，验证就通过了！十分地简单！</p>
<p>  接下来你大概会疑惑：怎么又弹了个窗？</p>
<p>  这次可不是验证码，这次是设备锁：</p>
<p>  【这里还缺一张图笔者醒来再补】</p>
<p>  想通过设备锁有很多种方法，但都有一个前提要求：手机与电脑在同一网络环境下（出口 IP 最好相同），而如果你的机器不在你身边，还有替代方法可以让你和机器”统一出口 IP“，但是我不能也不敢展开讲，懂得都懂。</p>
<p>  简单口述两种最简单的方法：</p>
<p>  ①将链接直接复制进浏览器打开，拿出手机登录账号扫码验证。</p>
<p>  ②将链接发送至手机，在 QQ 中打开此链接（登录此账号）进行验证。（你可以用将链接发给你自己等方式在 QQ 中打开链接）</p>
<p>  那么，在通过设备锁之后， MCL 的配置就完成了，接下来要安装 MAH 了。</p>
<h3 id="4-安装-mirai-api-http"><a href="#4-安装-mirai-api-http" class="headerlink" title="4. 安装 mirai-api-http"></a>4. 安装 mirai-api-http</h3><p>  安装 mirai-api-http 有两种方式，一种是使用 MCL 安装，另一种是手动安装，笔者使用的是手动安装，因为手动安装通常会更稳定，不会被 MCL 更新，毕竟生产环境求稳为上。</p>
<h4 id="I-使用-MCL-安装"><a href="#I-使用-MCL-安装" class="headerlink" title="I. 使用 MCL 安装"></a>I. 使用 MCL 安装</h4><p>  这十分的简单。</p>
<p>  Win + R 输入 cmd 回车打开命令提示符，切换到 MCL 安装目录，输入：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mcl --update-package net.mamoe:mirai-api-http --channel stable-v2 --type plugin<br>mcl -u<br></code></pre></td></tr></table></figure>

<p>  即可安装 MAH 的最新版本。</p>
<p>  如果你不会切换目录，你可以在安装目录下新建一个 <code>mah.txt</code>，填入上面的命令后保存，将 <code>mah.txt</code> 改为 <code>mah.bat</code>，警告选是，然后双击运行它即可。</p>
<blockquote>
<p>没有发现 .txt？那意味着你没有开启已知文件的后缀显示，请百度”Windows 开启后缀显示“。</p>
</blockquote>
<p>  当出现消息 <code>mirai-console started successfully.</code> 时，你可以在 mcl 中输入 <code>exit</code> 或者 <code>stop</code> 来安全退出，一般推荐以此种方式关闭 mcl。</p>
<h4 id="II-手动安装"><a href="#II-手动安装" class="headerlink" title="II. 手动安装"></a>II. 手动安装</h4><p>  这稍微麻烦一些，但并不难，如果你无法使用第一种方式或者不想用等种种原因，你可以使用手动安装。</p>
<p>  首先，打开 mah 的 <a target="_blank" rel="noopener" href="https://github.com/project-mirai/mirai-api-http/releases">Release</a>，下载最新的稳定版本，相关操作与上面 MCLI 类似，不再赘述。</p>
<p>  就像 Minecraft 安装 Mod 一样，Mirai 安装插件也只需要将 jar 文件拖入 <code>plugins</code> 文件夹即可，然后请按初始化 MCL 的方式操作一遍来生成配置。</p>
<p>  无论你选择哪一种方法安装，安装并初始化 MAH 完成后，接着的当然是配置它。</p>
<h3 id="5-配置-mirai-api-http"><a href="#5-配置-mirai-api-http" class="headerlink" title="5. 配置 mirai-api-http"></a>5. 配置 mirai-api-http</h3><p>  就像之前配置过的 <code>Autologin.yml</code> 一样，配置 MAH 也有一些不变的基本原则，也就是 yaml 的格式。</p>
<p>  记住，<strong>参数冒号后边一定要加一个空格！！！</strong></p>
<p>  这是易错项，总是有用户报这个错自己查了好久最后发现少了个空格。</p>
<p>  作为一般用户，你不需要知道 MAH 中的全部配置项意思，实际上对一般用户而言，唯一需要变动的可能就是 <code>verifyKey</code>，可以简单理解为密码。</p>
<p>  直接粘贴下面的配置，并改动 <code>verifyKey</code> 即可。</p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">## 启用的 adapter, 内置有 http, ws, reverse-ws, webhook</span><br><span class="hljs-attr">adapters:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">http</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ws</span><br><br><span class="hljs-comment">## 是否开启认证流程, 若为 true 则建立连接时需要验证 verifyKey</span><br><span class="hljs-comment">## 建议公网连接时开启</span><br><span class="hljs-attr">enableVerify:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">verifyKey:</span> <span class="hljs-number">1234567890</span><br><br><span class="hljs-comment">## 开启一些调式信息</span><br><span class="hljs-attr">debug:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment">## 是否开启单 session 模式, 若为 true，则自动创建 session 绑定 console 中登录的 bot</span><br><span class="hljs-comment">## 开启后，接口中任何 sessionKey 不需要传递参数</span><br><span class="hljs-comment">## 若 console 中有多个 bot 登录，则行为未定义</span><br><span class="hljs-comment">## 确保 console 中只有一个 bot 登陆时启用</span><br><span class="hljs-attr">singleMode:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment">## 历史消息的缓存大小</span><br><span class="hljs-comment">## 同时，也是 http adapter 的消息队列容量</span><br><span class="hljs-attr">cacheSize:</span> <span class="hljs-number">4096</span><br><br><span class="hljs-comment">## adapter 的单独配置，键名与 adapters 项配置相同</span><br><span class="hljs-attr">adapterSettings:</span><br>  <span class="hljs-comment">## 详情看 http adapter 使用说明 配置</span><br>  <span class="hljs-attr">http:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>    <span class="hljs-attr">cors:</span> [<span class="hljs-string">&quot;*&quot;</span>]<br>    <span class="hljs-attr">unreadQueueMaxSize:</span> <span class="hljs-number">100</span><br>  <br>  <span class="hljs-comment">## 详情看 websocket adapter 使用说明 配置</span><br>  <span class="hljs-attr">ws:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8060</span><br>    <span class="hljs-attr">reservedSyncId:</span> <span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure>

<h3 id="6-部署-Amiya-Bot"><a href="#6-部署-Amiya-Bot" class="headerlink" title="6. 部署 Amiya-Bot"></a>6. 部署 Amiya-Bot</h3><p>  折腾了这么久，总算是轮到部署 Amiya-Bot 了！但是……Amiya-Bot 有完备的文档，直接查阅 <a target="_blank" rel="noopener" href="https://www.amiya.cn/docs/deployByCode.html">项目官网</a> 即可。</p>
<p>  笔者十分推荐你使用代码部署而不是 exe，因为代码会比打包好的 exe 灵活得多（虽然这会需要你配置 Python 环境）。</p>
<p>  就这样。</p>
<p>  本文开头已经说了：</p>
<blockquote>
<p>在开始之前，需要说明的是，笔者因为自己就被文档坑过，所以为该项目完善了一些文档，下面可能会大量引用（当然，引用的文档不一定是笔者编写的），直接放上相关链接来看，本文只重点讲解文档没有涉及到的部分，比如 mirai 的部署和配置。</p>
</blockquote>
<p>  所以其实这篇文章其实主要是讲的 mirai 和 mah 的搭建和配置。</p>
<p>  不过还是补充几个要点：</p>
<ul>
<li>推荐下载 Python 3.8，务必将其添加进环境变量（安装时勾选 <code>Add PATH</code> 之类的选项）！</li>
<li>不要忘记还有个 <code>Playwright</code> 需要安装浏览器内核，pip 安装好依赖之后命令行输入：</li>
</ul>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">playwright install chromium<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>《明日方舟》机器人（其实是 QQBot 框架） Amiya-Bot 简明部署教程</div>
      <div>https://www.initbili.top/2022/cl72v4s0m0002x8u7h1gmgvpf/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Initial heart</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年8月21日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            BY-NC-SA 4.0
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/cl72v4s0h0001x8u77r1sbva3/" title="Windows 10/Windows Server 2016+ GPG 签名简明教程">
                        <span class="hidden-mobile">Windows 10/Windows Server 2016+ GPG 签名简明教程</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div style="align-items: center;">© Initial heart 2022-Present</div>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <br>本站大量使用了在 CC0 协议下授权的作品，衷心感谢这些作品的作者并向他们致以崇高的敬意。 <br><a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>







  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
